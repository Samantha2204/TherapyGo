{"ast":null,"code":"var _jsxFileName = \"/Users/sammi/Desktop/TherapyGo/src/pages/ClientOnePage/Components/Booking/CustomerAppointmentForm.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, memo, useEffect } from 'react';\nimport { Button, TextField } from '@material-ui/core';\nimport { ThemeProvider } from '@material-ui/core/styles';\nimport Swal from 'sweetalert2';\nimport emailjs from 'emailjs-com';\nimport { theme } from '../../../../colour';\nimport Select from '../../../../components/newAppointment/Select';\nimport './timeList.scss';\nimport { getTherapist, getDefaultPrice, getBodyPartsAndDurationData, submit } from '../../../../api/newAppointment-api';\nimport apiKeys from '../../../../config/apiKeys';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst CustomerAppointmentForm = /*#__PURE__*/memo(_c = _s(props => {\n  _s();\n\n  const [myDate, startTime, room] = props.data;\n  const {\n    cancelModal\n  } = props;\n  const initialValues = {\n    date: myDate,\n    time: startTime,\n    roomName: room,\n    firstName: '',\n    mobile: '',\n    treatmentStyle: '',\n    bodyPartsAndDuration: '',\n    therapistName: '',\n    paymentAmount: ''\n  };\n  const [values, setValues] = useState(initialValues);\n  const {\n    date,\n    time,\n    roomName,\n    firstName,\n    mobile,\n    treatmentStyle,\n    bodyPartsAndDuration,\n    therapistName,\n    paymentAmount\n  } = values;\n  const [therapistOptions, setTherapistOptions] = useState([]);\n  const [optionsOfBodyPartsAndDuration, setOptionsOfBodyPartsAndDuration] = useState([]);\n  const optionsOfTreatmentStyle = ['Dry', 'Oil', 'Deep Tissue'];\n  useEffect(() => {\n    setValues({ ...values,\n      roomName: room\n    });\n  }, [room]);\n\n  const handleChange = e => {\n    e.stopPropagation();\n    const {\n      name,\n      value\n    } = e.target;\n    setValues({ ...values,\n      [name]: value\n    });\n  };\n\n  const fetchTherapist = e => {\n    e.stopPropagation();\n    getTherapist(date, time, bodyPartsAndDuration).then(data => setTherapistOptions([...data])).catch(error => {\n      throw new Error(`Customer Appointment Form - fetch therapist ${error}`);\n    });\n  };\n\n  const fetchBodyParts = e => {\n    e.stopPropagation();\n    getBodyPartsAndDurationData(date, time, therapistName, roomName).then(list => setOptionsOfBodyPartsAndDuration([...list])).catch(error => {\n      throw new Error(`Customer Appointment Form - fetch body parts ${error}`);\n    });\n  };\n\n  const fetchPrice = e => {\n    e.stopPropagation();\n    let treatmentBodyPart = '';\n    let treatmentDuration = '';\n\n    if (bodyPartsAndDuration) {\n      const parts = bodyPartsAndDuration.split('--');\n      treatmentBodyPart = parts[0];\n      treatmentDuration = parts[1].split(' ')[0];\n    }\n\n    getDefaultPrice(treatmentBodyPart, treatmentDuration, treatmentStyle).then(price => setValues({ ...values,\n      paymentAmount: price\n    })).catch(error => {\n      throw new Error(`Customer Appointment Form - get default price ${error}`);\n    });\n  };\n\n  const handleCancel = () => {\n    Swal.fire('Cancel Booking?', 'The booking data will not record. Are you sure?', 'error').then(result => {\n      if (result.isConfirmed) {\n        cancelModal(false);\n      }\n    });\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    const role = 'customer';\n    submit(values, role).then(res => {\n      if (res.code === 200) {\n        const templateParams = {\n          name: values.firstName,\n          email: res.email,\n          date: values.date,\n          time: values.time,\n          treatment: values.treatmentStyle\n        };\n\n        if (res.email !== '' && res.email !== undefined) {\n          emailjs.send(apiKeys.emailjs.serviceId, apiKeys.emailjs.templateId, templateParams, apiKeys.emailjs.userId).then(response => {\n            if (response.status === 200) {\n              Swal.fire('Book Successfully!', 'The confirmation has been sent to your email.', 'success').then(result => {\n                if (result.isConfirmed) cancelModal(false);\n              });\n            } else {\n              Swal.fire('Confirmation Failed To Send!', 'Please contact our shop for further details.', 'error');\n            }\n          });\n        } else {\n          Swal.fire('Book Successfully!', 'Thank you for booking with us.', 'success').then(result => {\n            if (result.isConfirmed) cancelModal(false);\n          });\n        }\n      } else {\n        Swal.fire('Book Failed!', 'Error. Please Try Again...', 'error');\n      }\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"appointment-form-modal\",\n    onMouseDown: e => e.stopPropagation(),\n    children: /*#__PURE__*/_jsxDEV(\"form\", {\n      onSubmit: handleSubmit,\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"book an appointment\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Please confirm that you would like to request the following appointment:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(ThemeProvider, {\n          theme: theme,\n          children: [/*#__PURE__*/_jsxDEV(TextField, {\n            required: true,\n            className: \"input\",\n            label: \"Date\",\n            type: \"date\",\n            name: \"date\",\n            value: date,\n            onChange: handleChange,\n            variant: \"outlined\",\n            InputLabelProps: {\n              shrink: true\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 161,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TextField, {\n            required: true,\n            className: \"input\",\n            label: \"Start Time\",\n            name: \"time\",\n            type: \"time\",\n            value: time,\n            onChange: handleChange,\n            variant: \"outlined\",\n            InputLabelProps: {\n              shrink: true\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(ThemeProvider, {\n          theme: theme,\n          children: [/*#__PURE__*/_jsxDEV(Select, {\n            required: true,\n            label: \"Body Parts\",\n            name: \"bodyPartsAndDuration\",\n            value: bodyPartsAndDuration,\n            onChange: handleChange,\n            onFocus: fetchBodyParts,\n            options: optionsOfBodyPartsAndDuration\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Select, {\n            required: true,\n            label: \"Service Type\",\n            name: \"treatmentStyle\",\n            value: treatmentStyle,\n            onChange: handleChange,\n            onBlur: fetchPrice,\n            options: optionsOfTreatmentStyle\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(ThemeProvider, {\n          theme: theme,\n          children: [/*#__PURE__*/_jsxDEV(Select, {\n            required: true,\n            label: \"Therapist\",\n            name: \"therapistName\",\n            value: therapistName,\n            onFocus: fetchTherapist,\n            onChange: handleChange,\n            options: therapistOptions\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TextField, {\n            required: true,\n            label: \"Price\",\n            name: \"paymentAmount\",\n            value: paymentAmount,\n            onChange: handleChange,\n            variant: \"outlined\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 218,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(ThemeProvider, {\n          theme: theme,\n          children: [/*#__PURE__*/_jsxDEV(TextField, {\n            required: true,\n            label: \"Customer Name\",\n            name: \"firstName\",\n            value: firstName,\n            onChange: handleChange,\n            variant: \"outlined\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 230,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TextField, {\n            required: true,\n            label: \"Mobile\",\n            name: \"mobile\",\n            value: mobile,\n            onChange: handleChange,\n            variant: \"outlined\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(ThemeProvider, {\n          theme: theme,\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"contained\",\n            onClick: handleCancel,\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"contained\",\n            type: \"submit\",\n            disabled: therapistOptions.length === 0 || therapistOptions[0] === 'None' ? true : false,\n            children: \"Submit\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 155,\n    columnNumber: 5\n  }, this);\n}, \"XlnywbZ5veBIkELgakpnH+L0Ktw=\"));\n_c2 = CustomerAppointmentForm;\nexport default CustomerAppointmentForm;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"CustomerAppointmentForm$memo\");\n$RefreshReg$(_c2, \"CustomerAppointmentForm\");","map":{"version":3,"sources":["/Users/sammi/Desktop/TherapyGo/src/pages/ClientOnePage/Components/Booking/CustomerAppointmentForm.js"],"names":["React","useState","memo","useEffect","Button","TextField","ThemeProvider","Swal","emailjs","theme","Select","getTherapist","getDefaultPrice","getBodyPartsAndDurationData","submit","apiKeys","CustomerAppointmentForm","props","myDate","startTime","room","data","cancelModal","initialValues","date","time","roomName","firstName","mobile","treatmentStyle","bodyPartsAndDuration","therapistName","paymentAmount","values","setValues","therapistOptions","setTherapistOptions","optionsOfBodyPartsAndDuration","setOptionsOfBodyPartsAndDuration","optionsOfTreatmentStyle","handleChange","e","stopPropagation","name","value","target","fetchTherapist","then","catch","error","Error","fetchBodyParts","list","fetchPrice","treatmentBodyPart","treatmentDuration","parts","split","price","handleCancel","fire","result","isConfirmed","handleSubmit","preventDefault","role","res","code","templateParams","email","treatment","undefined","send","serviceId","templateId","userId","response","status","shrink","length"],"mappings":"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","sourcesContent":["import React, { useState, memo, useEffect } from 'react';\nimport { Button, TextField } from '@material-ui/core';\nimport { ThemeProvider } from '@material-ui/core/styles';\nimport Swal from 'sweetalert2';\nimport emailjs from 'emailjs-com';\nimport { theme } from '../../../../colour';\nimport Select from '../../../../components/newAppointment/Select';\nimport './timeList.scss';\nimport {\n  getTherapist,\n  getDefaultPrice,\n  getBodyPartsAndDurationData,\n  submit,\n} from '../../../../api/newAppointment-api';\nimport apiKeys from '../../../../config/apiKeys';\n\nconst CustomerAppointmentForm = memo((props) => {\n  const [myDate, startTime, room] = props.data;\n  const { cancelModal } = props;\n  const initialValues = {\n    date: myDate,\n    time: startTime,\n    roomName: room,\n    firstName: '',\n    mobile: '',\n    treatmentStyle: '',\n    bodyPartsAndDuration: '',\n    therapistName: '',\n    paymentAmount: '',\n  };\n  const [values, setValues] = useState(initialValues);\n  const {\n    date,\n    time,\n    roomName,\n    firstName,\n    mobile,\n    treatmentStyle,\n    bodyPartsAndDuration,\n    therapistName,\n    paymentAmount,\n  } = values;\n  const [therapistOptions, setTherapistOptions] = useState([]);\n  const [optionsOfBodyPartsAndDuration, setOptionsOfBodyPartsAndDuration] = useState([]);\n  const optionsOfTreatmentStyle = ['Dry', 'Oil', 'Deep Tissue'];\n\n  useEffect(() => {\n    setValues({ ...values, roomName: room });\n  }, [room]);\n\n  const handleChange = (e) => {\n    e.stopPropagation();\n    const { name, value } = e.target;\n    setValues({\n      ...values,\n      [name]: value,\n    });\n  };\n\n  const fetchTherapist = (e) => {\n    e.stopPropagation();\n    getTherapist(date, time, bodyPartsAndDuration)\n      .then((data) => setTherapistOptions([...data]))\n      .catch((error) => {\n        throw new Error(`Customer Appointment Form - fetch therapist ${error}`);\n      });\n  };\n\n  const fetchBodyParts = (e) => {\n    e.stopPropagation();\n    getBodyPartsAndDurationData(date, time, therapistName, roomName)\n      .then((list) => setOptionsOfBodyPartsAndDuration([...list]))\n      .catch((error) => {\n        throw new Error(`Customer Appointment Form - fetch body parts ${error}`);\n      });\n  };\n\n  const fetchPrice = (e) => {\n    e.stopPropagation();\n    let treatmentBodyPart = '';\n    let treatmentDuration = '';\n    if (bodyPartsAndDuration) {\n      const parts = bodyPartsAndDuration.split('--');\n      treatmentBodyPart = parts[0];\n      treatmentDuration = parts[1].split(' ')[0];\n    }\n    getDefaultPrice(treatmentBodyPart, treatmentDuration, treatmentStyle)\n      .then((price) => setValues({ ...values, paymentAmount: price }))\n      .catch((error) => {\n        throw new Error(`Customer Appointment Form - get default price ${error}`);\n      });\n  };\n\n  const handleCancel = () => {\n    Swal.fire('Cancel Booking?', 'The booking data will not record. Are you sure?', 'error').then(\n      (result) => {\n        if (result.isConfirmed) {\n          cancelModal(false);\n        }\n      },\n    );\n  };\n\n  const handleSubmit = (e) => {\n    e.preventDefault();\n    const role = 'customer';\n    submit(values, role).then((res) => {\n      if (res.code === 200) {\n        const templateParams = {\n          name: values.firstName,\n          email: res.email,\n          date: values.date,\n          time: values.time,\n          treatment: values.treatmentStyle,\n        };\n        if (res.email !== '' && res.email !== undefined) {\n          emailjs\n            .send(\n              apiKeys.emailjs.serviceId,\n              apiKeys.emailjs.templateId,\n              templateParams,\n              apiKeys.emailjs.userId,\n            )\n            .then((response) => {\n              if (response.status === 200) {\n                Swal.fire(\n                  'Book Successfully!',\n                  'The confirmation has been sent to your email.',\n                  'success',\n                ).then((result) => {\n                  if (result.isConfirmed) cancelModal(false);\n                });\n              } else {\n                Swal.fire(\n                  'Confirmation Failed To Send!',\n                  'Please contact our shop for further details.',\n                  'error',\n                );\n              }\n            });\n        } else {\n          Swal.fire('Book Successfully!', 'Thank you for booking with us.', 'success').then(\n            (result) => {\n              if (result.isConfirmed) cancelModal(false);\n            },\n          );\n        }\n      } else {\n        Swal.fire('Book Failed!', 'Error. Please Try Again...', 'error');\n      }\n    });\n  };\n\n  return (\n    <div className=\"appointment-form-modal\" onMouseDown={(e) => e.stopPropagation()}>\n      <form onSubmit={handleSubmit}>\n        <h3>book an appointment</h3>\n        <p>Please confirm that you would like to request the following appointment:</p>\n        <div>\n          <ThemeProvider theme={theme}>\n            <TextField\n              required\n              className=\"input\"\n              label=\"Date\"\n              type=\"date\"\n              name=\"date\"\n              value={date}\n              onChange={handleChange}\n              variant=\"outlined\"\n              InputLabelProps={{ shrink: true }}\n            />\n            <TextField\n              required\n              className=\"input\"\n              label=\"Start Time\"\n              name=\"time\"\n              type=\"time\"\n              value={time}\n              onChange={handleChange}\n              variant=\"outlined\"\n              InputLabelProps={{ shrink: true }}\n            />\n          </ThemeProvider>\n        </div>\n        <div>\n          <ThemeProvider theme={theme}>\n            <Select\n              required\n              label=\"Body Parts\"\n              name=\"bodyPartsAndDuration\"\n              value={bodyPartsAndDuration}\n              onChange={handleChange}\n              onFocus={fetchBodyParts}\n              options={optionsOfBodyPartsAndDuration}\n            />\n            <Select\n              required\n              label=\"Service Type\"\n              name=\"treatmentStyle\"\n              value={treatmentStyle}\n              onChange={handleChange}\n              onBlur={fetchPrice}\n              options={optionsOfTreatmentStyle}\n            />\n          </ThemeProvider>\n        </div>\n        <div>\n          <ThemeProvider theme={theme}>\n            <Select\n              required\n              label=\"Therapist\"\n              name=\"therapistName\"\n              value={therapistName}\n              onFocus={fetchTherapist}\n              onChange={handleChange}\n              options={therapistOptions}\n            />\n            <TextField\n              required\n              label=\"Price\"\n              name=\"paymentAmount\"\n              value={paymentAmount}\n              onChange={handleChange}\n              variant=\"outlined\"\n            />\n          </ThemeProvider>\n        </div>\n        <div>\n          <ThemeProvider theme={theme}>\n            <TextField\n              required\n              label=\"Customer Name\"\n              name=\"firstName\"\n              value={firstName}\n              onChange={handleChange}\n              variant=\"outlined\"\n            />\n            <TextField\n              required\n              label=\"Mobile\"\n              name=\"mobile\"\n              value={mobile}\n              onChange={handleChange}\n              variant=\"outlined\"\n            />\n          </ThemeProvider>\n        </div>\n        <div>\n          <ThemeProvider theme={theme}>\n            <Button\n              variant=\"contained\"\n              onClick={handleCancel}\n            >\n              Cancel\n            </Button>\n            <Button \n              variant=\"contained\" \n              type=\"submit\" \n              disabled={\n                therapistOptions.length === 0 || therapistOptions[0] === 'None' ? true : false\n              }\n            >\n              Submit\n            </Button>\n          </ThemeProvider>\n        </div>\n      </form>\n    </div>\n  );\n});\n\nexport default CustomerAppointmentForm;\n"]},"metadata":{},"sourceType":"module"}